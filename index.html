<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Electoy Studio - AI ÎÆ§ÏßÅ Ïä§ÌäúÎîîÏò§</title>
    <!-- ÌïÑÏàò ÎùºÏù¥Î∏åÎü¨Î¶¨: React, ReactDOM, Babel, Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Pretendard', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow: hidden; 
            height: 100vh;
            background-color: #020617;
            color: #e2e8f0;
        }
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        /* ÏãúÏù∏ÏÑ± Ï¢ãÏùÄ Ïª§Ïä§ÌÖÄ Ïä§ÌÅ¨Î°§Î∞î */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; border: 2px solid #020617; }
        
        /* ÏÑ∏Î†®Îêú Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º */
        @keyframes rotate-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-rotate-slow { animation: rotate-slow 25s linear infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .animate-float { animation: float 5s ease-in-out infinite; }
        @keyframes star-blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.8; } }
        .star { position: absolute; background: white; border-radius: 50%; animation: star-blink var(--duration) ease-in-out infinite; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 15px rgba(168, 85, 247, 0.3); } 50% { box-shadow: 0 0 30px rgba(168, 85, 247, 0.5); } }
        .animate-pulse-glow { animation: pulse-glow 4s infinite; }

        .active-tab { background: #334155; color: white !important; border: 1px solid #94a3b8 !important; }
        .modal-overlay { background: rgba(0, 0, 0, 0.96); backdrop-filter: blur(15px); z-index: 100; }
        
        /* Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº Î≥µÍµ¨ */
        .card-container {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid #334155;
            border-radius: 1.5rem;
            padding: 1.5rem;
            transition: all 0.2s;
            backdrop-filter: blur(8px);
        }
        .card-container:hover {
            border-color: #a855f7;
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .editable-area {
            width: 100%;
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid #334155;
            border-radius: 1.5rem;
            padding: 1.2rem;
            color: #f8fafc;
            font-size: 1.05rem; 
            line-height: 1.6;
            outline: none;
            resize: none;
            font-weight: 500;
        }

        .revision-input {
            background: rgba(30, 41, 59, 0.8);
            border: 2px dashed #475569;
            border-radius: 1.2rem;
            padding: 1.5rem;
            color: #e2e8f0;
            width: 100%;
            min-height: 120px; 
            font-size: 1.1rem;
            outline: none;
            transition: all 0.3s;
            resize: none;
        }
        .revision-input:focus { border-color: #a855f7; background: rgba(30, 41, 59, 1); }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23cbd5e1'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
        }
        input[type="range"] { accent-color: #a855f7; }

        .persona-badge {
            background: rgba(168, 85, 247, 0.15);
            color: #d8b4fe;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid rgba(168, 85, 247, 0.3);
            white-space: nowrap;
        }

        /* [Ï°∞ÏùÄ ÏöîÏ≤≠] Î∞∞Í≤ΩÏù¥ Î∞ùÍ≥† Ïûò Î≥¥Ïù¥ÎèÑÎ°ù ÏàòÏ†ï */
        .entrance-overlay {
            position: fixed;
            inset: 0;
            z-index: 200;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        /* Ïò§Î≤ÑÎ†àÏù¥ Ìà¨Î™ÖÎèÑÎ•º ÎÇÆÏ∂∞ÏÑú(0.3) Î∞∞Í≤Ω ÏÇ¨ÏßÑÏù¥ Ìõ®Ïî¨ Ïûò Î≥¥Ïù¥Í≤å Ìï® */
        .entrance-overlay::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(2, 6, 23, 0.3); 
            z-index: -1;
        }
        .entrance-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .library-item {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid #334155;
            transition: all 0.2s;
        }
        .library-item:hover {
            border-color: #a855f7;
            background: rgba(30, 41, 59, 0.8);
        }
        
        .mood-chip {
            padding: 10px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 700;
            text-align: center;
            transition: all 0.2s;
            background: #2d2d2d;
            color: #ffffff;
            border: 1px solid transparent;
        }
        .mood-chip.selected {
            background: #1d4ed8; 
            box-shadow: 0 0 15px rgba(29, 78, 216, 0.4);
        }

        .inst-chip {
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 700;
            transition: all 0.2s;
            border: 2px solid #1e293b;
            background: #0f172a;
            color: #64748b;
            text-align: center;
        }
        .inst-chip.selected {
            background: rgba(168, 85, 247, 0.2);
            border-color: #a855f7;
            color: #d8b4fe;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.2);
        }

        .api-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid transparent;
            color: #64748b;
            transition: all 0.2s;
        }
        .api-tab.active {
            color: #a855f7;
            border-bottom-color: #a855f7;
            background: rgba(168, 85, 247, 0.05);
        }
    </style>
</head>
<body class="text-slate-100 flex justify-center text-left">
    <div id="root" class="w-full max-w-md border-x border-slate-900 bg-slate-950 relative shadow-2xl overflow-hidden text-left"></div>

    <script>
        const Icons = {
            Music: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>`,
            Sparkles: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"></path></svg>`,
            Key: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.778-7.778Zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3-3.5 3.5Z"></path></svg>`,
            Copy: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg>`,
            Check: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
            Pencil: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>`,
            Share: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg>`,
            ChevronRight: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`,
            X: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
            Disc: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle></svg>`,
            Refresh: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path><polyline points="21 3 21 8 16 8"></polyline></svg>`,
            User: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
            Save: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>`,
            Trash: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>`,
            Library: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`,
            AlertCircle: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,
            Instrument: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>`,
            Heart: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`,
            Layout: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></svg>`,
            Tag: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>`,
            Globe: () => `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" x2="22" y1="12" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>`
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const svgStr = Icons[name] ? Icons[name]() : '';
            return React.createElement('div', {
                className: className,
                style: { width: size, height: size, display: 'flex', alignItems: 'center', justifyContent: 'center' },
                dangerouslySetInnerHTML: { __html: svgStr.replace('width="24"', `width="${size}"`).replace('height="24"', `height="${size}"`) }
            });
        };
    </script>

    <!-- React Ïï± Î©îÏù∏ Î°úÏßÅ -->
    <script type="text/babel">
        // Global definition to satisfy environment requirements
        const apiKey = ""; 

        const { useState, useEffect, useRef } = React;

        const genresList = ['K-Pop', 'Î∞úÎùºÎìú', 'Ìåù', 'ÌûôÌï©', 'R&B', 'Î°ù', 'EDM', 'Ïû¨Ï¶à', 'Lo-fi', 'Ïñ¥Ïø†Ïä§Ìã±', 'ÌÅ¥ÎûòÏãù', 'ÏãúÌã∞Ìåù', 'Ìä∏Î°úÌä∏', 'Íµ≠ÏïÖ', 'Îâ¥ÏóêÏù¥ÏßÄ', 'ÏõîÎìúÎÆ§ÏßÅ'];
        const moodsGrid = [
            'Ï∞®Î∂ÑÌïú', 'Ïö∞Ïö∏Ìïú', 'Ïô∏Î°úÏö¥', 'Í∑∏Î¶¨Ïö¥',
            'Î™ΩÌôòÏ†ÅÏù∏', 'Ìù¨ÎßùÏ∞¨', 'Ïñ¥ÎëêÏö¥', 'ÎÇ≠ÎßåÏ†ÅÏù∏',
            'ÎãπÎãπÌïú', 'Ïä¨Ìîà', 'Í∞êÏÑ±Ï†ÅÏù∏', 'ÏπúÎ∞ÄÌïú',
            'Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'ÏòÅÌôîÍ∞ôÏùÄ', 'ÌôúÍ∏∞Ï∞¨', 'Ïã†ÎπÑÎ°úÏö¥',
            'Ïï†ÌããÌïú', 'Îî∞ÎúªÌïú', 'Ï∞®Í∞ÄÏö¥', 'Í±∞Ïπú'
        ];
        const energyOptions = ['ÎÇÆÏùå', 'Ï§ëÍ∞Ñ', 'ÎÑòÏπ®'];
        const instrumentsList = [
            'ÌîºÏïÑÎÖ∏', 'Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ', 'ÏùºÎ†â Í∏∞ÌÉÄ', 'Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä', 'Î∞îÏù¥Ïò¨Î¶∞', 'Ï≤ºÎ°ú', 'ÏΩòÌä∏ÎùºÎ≤†Ïù¥Ïä§',
            'ÏÉâÏÜåÌè∞', 'Ìä∏ÎüºÌé´', 'ÌîåÎ£®Ìä∏', 'ÌÅ¥ÎùºÎ¶¨ÎÑ∑', 'ÌïòÌîÑ', 'ÌååÏù¥ÌîÑ Ïò§Î•¥Í∞Ñ', 'ÌïòÎ™®ÎãàÏπ¥', 'Î∞¥Ï°∞', 'Ïö∞Ïø®Î†êÎ†à',
            'ÎìúÎüº Î®∏Ïã†', 'Î≤†Ïù¥Ïä§ Í∏∞ÌÉÄ', 'ÌçºÏª§ÏÖò', 'Ï†¨Î≤†', 'Í∞ÄÏïºÍ∏à', 'Í±∞Î¨∏Í≥†', 'Ìï¥Í∏à', 'Ï†ÑÍ∏∞ ÌîºÏïÑÎÖ∏'
        ];

        // Ïó∞Ï£ºÍ≥° Ïä§ÌÉÄÏùº 15Ï¢Ö
        const instrumentalSubStyles = [
            { id: 'is_1', label: '1. ÌîºÏïÑÎÖ∏ ÏÜîÎ°ú', genre: 'Îâ¥ÏóêÏù¥ÏßÄ', moods: ['Ï∞®Î∂ÑÌïú', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['ÌîºÏïÑÎÖ∏'], bpm: 75 },
            { id: 'is_2', label: '2. Î°úÌååÏù¥ Ïπ†', genre: 'Lo-fi', moods: ['Î™ΩÌôòÏ†ÅÏù∏', 'Ï∞®Î∂ÑÌïú'], inst: ['Ï†ÑÍ∏∞ ÌîºÏïÑÎÖ∏'], bpm: 90 },
            { id: 'is_3', label: '3. Ïò§ÏºÄÏä§Ìä∏Îùº', genre: 'ÌÅ¥ÎûòÏãù', moods: ['ÏòÅÌôîÍ∞ôÏùÄ', 'Ïã†ÎπÑÎ°úÏö¥'], inst: ['Î∞îÏù¥Ïò¨Î¶∞', 'Ï≤ºÎ°ú'], bpm: 80 },
            { id: 'is_4', label: '4. Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ', genre: 'Ïñ¥Ïø†Ïä§Ìã±', moods: ['Îî∞ÎúªÌïú', 'ÏπúÎ∞ÄÌïú'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], bpm: 95 },
            { id: 'is_5', label: '5. Ïû¨Ï¶à ÏøºÌÖü', genre: 'Ïû¨Ï¶à', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Ï∞®Í∞ÄÏö¥'], inst: ['ÏÉâÏÜåÌè∞', 'ÏΩòÌä∏ÎùºÎ≤†Ïù¥Ïä§'], bpm: 110 },
            { id: 'is_6', label: '6. Íµ≠ÏïÖ ÏïôÏÉÅÎ∏î', genre: 'Íµ≠ÏïÖ', moods: ['Í∑∏Î¶¨Ïö¥', 'Ïã†ÎπÑÎ°úÏö¥'], inst: ['Í∞ÄÏïºÍ∏à', 'Ìï¥Í∏à'], bpm: 85 },
            { id: 'is_7', label: '7. Ïï∞ÎπÑÏñ∏Ìä∏', genre: 'Îâ¥ÏóêÏù¥ÏßÄ', moods: ['Ïã†ÎπÑÎ°úÏö¥', 'Î™ΩÌôòÏ†ÅÏù∏'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], bpm: 60 },
            { id: 'is_8', label: '8. ÌÉÄÏïÖ Î¶¨Îì¨', genre: 'ÏõîÎìúÎÆ§ÏßÅ', moods: ['Í±∞Ïπú', 'ÌôúÍ∏∞Ï∞¨'], inst: ['Ï†¨Î≤†', 'ÌçºÏª§ÏÖò'], bpm: 125 },
            { id: 'is_9', label: '9. Ïã†Ïä§Ïõ®Ïù¥Î∏å', genre: 'EDM', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'ÌôúÍ∏∞Ï∞¨'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], bpm: 120 },
            { id: 'is_10', label: '10. ÌéëÌÇ§ Î≤†Ïù¥Ïä§', genre: 'R&B', moods: ['ÎãπÎãπÌïú', 'ÌôúÍ∏∞Ï∞¨'], inst: ['Î≤†Ïù¥Ïä§ Í∏∞ÌÉÄ', 'ÎìúÎüº Î®∏Ïã†'], bpm: 115 },
            { id: 'is_11', label: '11. Ïä§ÌéòÎãàÏãú Í∏∞ÌÉÄ', genre: 'ÏõîÎìúÎÆ§ÏßÅ', moods: ['ÎÇ≠ÎßåÏ†ÅÏù∏', 'Í±∞Ïπú'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], bpm: 105 },
            { id: 'is_12', label: '12. Ï±îÎ≤Ñ ÌÅ¥ÎûòÏãù', genre: 'ÌÅ¥ÎûòÏãù', moods: ['Ï∞®Î∂ÑÌïú', 'ÏπúÎ∞ÄÌïú'], inst: ['Î∞îÏù¥Ïò¨Î¶∞', 'ÌïòÌîÑ'], bpm: 70 },
            { id: 'is_13', label: '13. Îã§ÌÅ¨ ÌÖåÌÅ¨ÎÖ∏', genre: 'EDM', moods: ['Ïñ¥ÎëêÏö¥', 'Í±∞Ïπú'], inst: ['ÎìúÎüº Î®∏Ïã†', 'Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], bpm: 135 },
            { id: 'is_14', label: '14. ÏãúÎÑ§ÎßàÌã± ÏÑúÏä§ÌéúÏä§', genre: 'Î∞úÎùºÎìú', moods: ['Ïã†ÎπÑÎ°úÏö¥', 'ÏòÅÌôîÍ∞ôÏùÄ'], inst: ['Ï≤ºÎ°ú', 'Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], bpm: 65 },
            { id: 'is_15', label: '15. ÌûêÎßÅ Î™ÖÏÉÅÏùåÏïÖ', genre: 'Îâ¥ÏóêÏù¥ÏßÄ', moods: ['Ï∞®Î∂ÑÌïú', 'Ìù¨ÎßùÏ∞¨'], inst: ['ÌïòÌîÑ', 'ÌîºÏïÑÎÖ∏'], bpm: 50 }
        ];

        const App = () => {
            const [isEntered, setIsEntered] = useState(false);
            const [geminiKey, setGeminiKey] = useState('');
            const [gptKey, setGptKey] = useState('');
            const [apiProvider, setApiProvider] = useState('gemini'); 
            const [title, setTitle] = useState('');
            const [persona, setPersona] = useState({ name: 'ÏÉà ÌîÑÎ°úÌïÑ', gender: 'Ïó¨ÏÑ±', age: '20ÎåÄ', tone: 'ÎßëÍ≥† Íπ®ÎÅóÌïú', style: 'Í∞êÏÑ±Ï†ÅÏù∏', voiceId: '' });
            const [selectedGenres, setSelectedGenres] = useState(['K-Pop']);
            const [selectedMoods, setSelectedMoods] = useState(['Î™ΩÌôòÏ†ÅÏù∏']);
            const [energy, setEnergy] = useState('Ï§ëÍ∞Ñ');
            const [bpm, setBpm] = useState(120);
            const [duration, setDuration] = useState(120);
            const [selectedInstruments, setSelectedInstruments] = useState(['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä']);
            const [instrument, setInstrument] = useState('ÏÑ§Ï†ï Ïïà Ìï®');
            const [prompt, setPrompt] = useState('');
            const [revisionPrompt, setRevisionPrompt] = useState('');
            const [showApiModal, setShowApiModal] = useState(false);
            const [showPersonaModal, setShowPersonaModal] = useState(false);
            const [showMoodModal, setShowMoodModal] = useState(false);
            const [showInstModal, setShowInstModal] = useState(false);
            const [showClearConfirm, setShowClearConfirm] = useState(false);
            const [toast, setToast] = useState({ show: false, message: '' });
            const [generatingType, setGeneratingType] = useState(null); 
            const [activeThemeTab, setActiveThemeTab] = useState('Ïù∏Í∏∞ Ïû•Î•¥');
            const [editableStyle, setEditableStyle] = useState('');
            const [editableLyrics, setEditableLyrics] = useState('');
            const [hasResult, setHasResult] = useState(false);
            const [copyStatus, setCopyStatus] = useState({ lyrics: false, style: false });
            const [library, setLibrary] = useState([]);

            const isInstrumental = persona.gender === 'Ïó∞Ï£ºÍ≥° (Instrumental)';

            // [Ï°∞ÏùÄ ÏöîÏ≤≠] Î∞úÎùºÎìú Ïπ¥ÌÖåÍ≥†Î¶¨ 8Í∞ú ÏôÑÏ†Ñ Î≥µÍµ¨
            const themes = [
                { category: 'Ïù∏Í∏∞ Ïû•Î•¥', items: [
                    { id: 'p_kpop', label: 'üé§ ÎåÑÏä§ / K-POP', genre: 'K-Pop', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 124 },
                    { id: 'p_rnb', label: 'üé∏ ÌûôÌï© / R&B', genre: 'ÌûôÌï©', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Í±∞Ïπú'], inst: ['ÎìúÎüº Î®∏Ïã†'], gender: 'ÎÇ®ÏÑ±', bpm: 95 },
                    { id: 'p_indie', label: 'üéπ Ïù∏Îîî / Ïñ¥Ïø†Ïä§Ìã±', genre: 'Ïñ¥Ïø†Ïä§Ìã±', moods: ['Îî∞ÎúªÌïú', 'Í∑∏Î¶¨Ïö¥'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], gender: 'Ïó¨ÏÑ±', bpm: 85 },
                    { id: 'p_ost', label: 'üé¨ OST Í∞êÏÑ±', genre: 'Î∞úÎùºÎìú', moods: ['ÏòÅÌôîÍ∞ôÏùÄ', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['Î∞îÏù¥Ïò¨Î¶∞'], gender: 'Ïó¨ÏÑ±', bpm: 75 },
                    { id: 'p_retro', label: 'üï∞Ô∏è Î™ÖÍ≥° / Î†àÌä∏Î°ú', genre: 'ÏãúÌã∞Ìåù', moods: ['Í∑∏Î¶¨Ïö¥', 'Î™ΩÌôòÏ†ÅÏù∏'], inst: ['Î≤†Ïù¥Ïä§ Í∏∞ÌÉÄ'], gender: 'Ïó¨ÏÑ±', bpm: 110 },
                    { id: 'p_pop', label: 'üåç POP / Ìï¥Ïô∏', genre: 'Ìåù', moods: ['Ìù¨ÎßùÏ∞¨', 'ÎÇ≠ÎßåÏ†ÅÏù∏'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 105 },
                    { id: 'p_lofi', label: 'üåô Î°úÌååÏù¥ / Lo-fi', genre: 'Lo-fi', moods: ['Ï∞®Î∂ÑÌïú', 'Î∂ÑÏúÑÍ∏∞ÏûàÎäî'], inst: ['Ï†ÑÍ∏∞ ÌîºÏïÑÎÖ∏'], gender: 'Ïó∞Ï£ºÍ≥° (Instrumental)', bpm: 90 },
                    { id: 'p_rock', label: 'üé∏ Î°ù / ÏñºÌÑ∞ÎÑàÌã∞Î∏å', genre: 'Î°ù', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 128 }
                ]},
                { category: 'Î∞úÎùºÎìú', items: [
                    { id: 'b_bye', label: 'üíî Ïù¥Î≥Ñ¬∑Í∑∏Î¶¨ÏõÄ', genre: 'Î∞úÎùºÎìú', moods: ['Ïä¨Ìîà', 'Ïô∏Î°úÏö¥'], inst: ['ÌîºÏïÑÎÖ∏'], gender: 'Ïó¨ÏÑ±', bpm: 68 },
                    { id: 'b_love', label: 'üíï ÏÇ¨Îûë¬∑ÏÑ§Î†ò', genre: 'Î∞úÎùºÎìú', moods: ['ÎÇ≠ÎßåÏ†ÅÏù∏', 'Ìù¨ÎßùÏ∞¨'], inst: ['ÌîºÏïÑÎÖ∏'], gender: 'ÎÇ®ÎÖÄ ÎìÄÏó£', bpm: 76 },
                    { id: 'b_sad_tear', label: 'üåßÔ∏è Ïä¨Ìîî¬∑ÎààÎ¨º', genre: 'Î∞úÎùºÎìú', moods: ['Ïä¨Ìîà', 'Ïö∞Ïö∏Ìïú'], inst: ['Ï≤ºÎ°ú'], gender: 'Ïó¨ÏÑ±', bpm: 62 },
                    { id: 'b_heal', label: 'üåø ÏúÑÎ°ú¬∑ÌûêÎßÅ', genre: 'Î∞úÎùºÎìú', moods: ['Îî∞ÎúªÌïú', 'Ï∞®Î∂ÑÌïú'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 80 },
                    { id: 'b_night', label: 'üåô Î∞§ Í∞êÏÑ±', genre: 'Î∞úÎùºÎìú', moods: ['Î™ΩÌôòÏ†ÅÏù∏', 'ÏπúÎ∞ÄÌïú'], inst: ['Ï†ÑÍ∏∞ ÌîºÏïÑÎÖ∏'], gender: 'Ïó¨ÏÑ±', bpm: 70 },
                    { id: 'b_ost_emo', label: 'üé¨ OST Í∞êÏÑ±', genre: 'Î∞úÎùºÎìú', moods: ['ÏòÅÌôîÍ∞ôÏùÄ', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['Î∞îÏù¥Ïò¨Î¶∞'], gender: 'Ïó¨ÏÑ±', bpm: 74 },
                    { id: 'b_high', label: 'üî• Í≥†Ïùå¬∑Ìè≠Î∞ú', genre: 'Î∞úÎùºÎìú', moods: ['ÎãπÎãπÌïú', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 72 },
                    { id: 'b_aco', label: 'üé∏ Ïñ¥Ïø†Ïä§Ìã±¬∑Í∞êÏÑ±', genre: 'Ïñ¥Ïø†Ïä§Ìã±', moods: ['Îî∞ÎúªÌïú', 'Í∑∏Î¶¨Ïö¥'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], gender: 'Ïó¨ÏÑ±', bpm: 82 }
                ]},
                { category: 'ÎåÑÏä§/ÏùºÎ†â', items: [
                    { id: 'd_kpop', label: 'üé§ K-POP ÎåÑÏä§', genre: 'K-Pop', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 128 },
                    { id: 'd_edm', label: 'üî• EDM ÌéòÏä§Ìã∞Î≤å', genre: 'EDM', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'ÎÇ®ÏÑ±', bpm: 132 },
                    { id: 'd_hou', label: 'üéß ÌïòÏö∞Ïä§', genre: 'EDM', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Ïã†ÎπÑÎ°úÏö¥'], inst: ['Î≤†Ïù¥Ïä§ Í∏∞ÌÉÄ'], gender: 'Ïó¨ÏÑ±', bpm: 124 },
                    { id: 'd_tec', label: 'üñ§ ÌÖåÌÅ¨ÎÖ∏', genre: 'EDM', moods: ['Ïñ¥ÎëêÏö¥', 'Í±∞Ïπú'], inst: ['ÎìúÎüº Î®∏Ïã†'], gender: 'ÎÇ®ÏÑ±', bpm: 135 },
                    { id: 'd_tra', label: 'üåå Ìä∏ÎûúÏä§', genre: 'EDM', moods: ['Î™ΩÌôòÏ†ÅÏù∏', 'ÌôúÍ∏∞Ï∞¨'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'ÎÇ®ÏÑ±', bpm: 140 },
                    { id: 'd_pop', label: 'üï∫ ÎåÑÏä§ Ìåù', genre: 'Ìåù', moods: ['Ìù¨ÎßùÏ∞¨', 'ÎÇ≠ÎßåÏ†ÅÏù∏'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 120 },
                    { id: 'd_electro', label: '‚ö° ÏùºÎ†âÌä∏Î°ú Ìåù', genre: 'Ìåù', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 122 },
                    { id: 'd_disco', label: '‚ú® ÎîîÏä§ÏΩî/ÌéëÌÅ¨', genre: 'EDM', moods: ['ÌôúÍ∏∞Ï∞¨', 'Îî∞ÎúªÌïú'], inst: ['Î≤†Ïù¥Ïä§ Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÎÖÄ ÎìÄÏó£', bpm: 118 }
                ]},
                { category: 'Ï†ÑÌÜµÍ∞ÄÏöî', items: [
                    { id: 't_pure', label: 'üéôÔ∏è Ï†ïÌÜµ Ìä∏Î°Ø', genre: 'Ìä∏Î°úÌä∏', moods: ['Í∑∏Î¶¨Ïö¥', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['ÏÉâÏÜåÌè∞'], gender: 'Ïó¨ÏÑ±', bpm: 135 },
                    { id: 't_semi', label: 'üíÉ ÏÑ∏ÎØ∏ Ìä∏Î°Ø', genre: 'Ìä∏Î°úÌä∏', moods: ['ÌôúÍ∏∞Ï∞¨', 'Ìù¨ÎßùÏ∞¨'], inst: ['ÌîºÏïÑÎÖ∏'], gender: 'Ïó¨ÏÑ±', bpm: 130 },
                    { id: 't_new', label: '‚ú® Ïã†ÏÑ∏ÎåÄ Ìä∏Î°Ø', genre: 'Ìä∏Î°úÌä∏', moods: ['ÎãπÎãπÌïú', 'ÌôúÍ∏∞Ï∞¨'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 140 },
                    { id: 't_fus', label: 'üéé Ìì®Ï†Ñ Ìä∏Î°Ø', genre: 'Íµ≠ÏïÖ', moods: ['ÏòÅÌôîÍ∞ôÏùÄ', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['Í∞ÄÏïºÍ∏à'], gender: 'Ïó¨ÏÑ±', bpm: 110 },
                    { id: 't_dan', label: 'üï∫ ÎåÑÏä§ Ìä∏Î°Ø', genre: 'Ìä∏Î°úÌä∏', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['ÎìúÎüº Î®∏Ïã†'], gender: 'ÎÇ®ÏÑ±', bpm: 142 },
                    { id: 't_bal', label: 'üíî Î∞úÎùºÎìú Ìä∏Î°Ø', genre: 'Î∞úÎùºÎìú', moods: ['Ïä¨Ìîà', 'Í∞êÏÑ±Ï†ÅÏù∏'], inst: ['Î∞îÏù¥Ïò¨Î¶∞'], gender: 'Ïó¨ÏÑ±', bpm: 70 },
                    { id: 't_soul', label: 'üé∑ ÏÜåÏö∏ Ìä∏Î°Ø', genre: 'Ìä∏Î°úÌä∏', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Îî∞ÎúªÌïú'], inst: ['ÏÉâÏÜåÌè∞'], gender: 'ÎÇ®ÏÑ±', bpm: 128 },
                    { id: 't_folk', label: 'üéã Ìè¨ÌÅ¨ Ìä∏Î°Ø', genre: 'Ïñ¥Ïø†Ïä§Ìã±', moods: ['Í∑∏Î¶¨Ïö¥', 'Îî∞ÎúªÌïú'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], gender: 'Ïó¨ÏÑ±', bpm: 120 }
                ]},
                { category: 'Î°ù/ÏñºÌÑ∞ÎÑàÌã∞Î∏å', items: [
                    { id: 'r_hard', label: 'ü§ò ÌïòÎìú Î°ù', genre: 'Î°ù', moods: ['ÎãπÎãπÌïú', 'Ïñ¥ÎëêÏö¥'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 130 },
                    { id: 'r_punk', label: '‚ö° ÌéëÌÅ¨ Î°ù', genre: 'Î°ù', moods: ['ÌôúÍ∏∞Ï∞¨', 'Í±∞Ïπú'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 160 },
                    { id: 'r_metal', label: 'üé∏ Ìó§ÎπÑ Î©îÌÉà', genre: 'Î°ù', moods: ['Ïñ¥ÎëêÏö¥', 'ÎãπÎãπÌïú'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 140 },
                    { id: 'r_indie', label: 'üéπ Ïù∏Îîî Î°ù', genre: 'Î°ù', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Î™ΩÌôòÏ†ÅÏù∏'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], gender: 'Ïó¨ÏÑ±', bpm: 120 },
                    { id: 'r_brit', label: 'üá¨üáß Î∏åÎ¶ø Ìåù', genre: 'Î°ù', moods: ['Ìù¨ÎßùÏ∞¨', 'Í∑∏Î¶¨Ïö¥'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 115 },
                    { id: 'r_garage', label: 'üöó Í∞ÄÎùºÏßÄ Î°ù', genre: 'Î°ù', moods: ['Í±∞Ïπú', 'Ïñ¥ÎëêÏö¥'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 135 },
                    { id: 'r_grunge', label: 'üß• Í∑∏Îü∞ÏßÄ Î°ù', genre: 'Î°ù', moods: ['Ïö∞Ïö∏Ìïú', 'Í±∞Ïπú'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 100 },
                    { id: 'r_classic', label: 'üìª ÌÅ¥ÎûòÏãù Î°ù', genre: 'Î°ù', moods: ['ÎãπÎãπÌïú', 'Îî∞ÎúªÌïú'], inst: ['ÏùºÎ†â Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 120 }
                ]},
                { category: 'Ìì®Ï†Ñ/Ïã§Ìóò', items: [
                    { id: 'f_acid', label: 'üé∑ Ïï†ÏãúÎìú Ïû¨Ï¶à', genre: 'Ïû¨Ï¶à', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Îî∞ÎúªÌïú'], inst: ['ÏÉâÏÜåÌè∞'], gender: 'Ïó∞Ï£ºÍ≥° (Instrumental)', bpm: 115 },
                    { id: 'f_synth', label: 'üéπ Ïã†Ïä§ Ìåù', genre: 'Ìåù', moods: ['Î™ΩÌôòÏ†ÅÏù∏', 'Ìù¨ÎßùÏ∞¨'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 120 },
                    { id: 'f_raga', label: 'ÎùºÍ∞Ä Î∏åÎ†àÏù¥ÌÅ¨', genre: 'ÏõîÎìúÎÆ§ÏßÅ', moods: ['Ïã†ÎπÑÎ°úÏö¥', 'Î∂ÑÏúÑÍ∏∞ÏûàÎäî'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó∞Ï£ºÍ≥° (Instrumental)', bpm: 130 },
                    { id: 'f_hyphy', label: 'ÌïòÏù¥Ìîº R&B', genre: 'ÌûôÌï©', moods: ['ÌôúÍ∏∞Ï∞¨', 'ÎãπÎãπÌïú'], inst: ['ÎìúÎüº Î®∏Ïã†'], gender: 'ÎÇ®ÏÑ±', bpm: 105 },
                    { id: 'f_alt_rnb', label: 'ÏñºÌÑ∞ÎÑàÌã∞Î∏å R&B', genre: 'R&B', moods: ['Î∂ÑÏúÑÍ∏∞ÏûàÎäî', 'Î™ΩÌôòÏ†ÅÏù∏'], inst: ['Ï†ÑÍ∏∞ ÌîºÏïÑÎÖ∏'], gender: 'Ïó¨ÏÑ±', bpm: 90 },
                    { id: 'f_acoustic_trance', label: 'Ïñ¥Ïø†Ïä§Ìã± Ìä∏ÎûúÏä§', genre: 'Ïñ¥Ïø†Ïä§Ìã±', moods: ['Î™ΩÌôòÏ†ÅÏù∏', 'Ï∞®Î∂ÑÌïú'], inst: ['Ïñ¥Ïø†Ïä§Ìã± Í∏∞ÌÉÄ'], gender: 'Ïó∞Ï£ºÍ≥° (Instrumental)', bpm: 110 },
                    { id: 'f_gfunk', label: 'ÏßÄÌéëÌÅ¨ EDM', genre: 'ÌûôÌï©', moods: ['ÎãπÎãπÌïú', 'Îî∞ÎúªÌïú'], inst: ['Î≤†Ïù¥Ïä§ Í∏∞ÌÉÄ'], gender: 'ÎÇ®ÏÑ±', bpm: 100 },
                    { id: 'f_psych', label: 'ÏÇ¨Ïù¥ÌÇ§Îç∏Î¶≠ ÌïòÏö∞Ïä§', genre: 'EDM', moods: ['Ïã†ÎπÑÎ°úÏö¥', 'Î™ΩÌôòÏ†ÅÏù∏'], inst: ['Ïã†ÎîîÏÇ¨Ïù¥Ï†Ä'], gender: 'Ïó¨ÏÑ±', bpm: 124 }
                ]}
            ];

            const entranceImageUrl = "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?auto=format&fit=crop&q=80&w=1920";

            useEffect(() => {
                const savedData = localStorage.getItem('electoy-studio-config-v14');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        if (parsed.geminiKey) setGeminiKey(parsed.geminiKey);
                        if (parsed.gptKey) setGptKey(parsed.gptKey);
                        if (parsed.apiProvider) setApiProvider(parsed.apiProvider);
                        if (parsed.persona) setPersona(parsed.persona);
                        if (parsed.library) setLibrary(parsed.library);
                        if (parsed.selectedInstruments) setSelectedInstruments(parsed.selectedInstruments);
                        if (parsed.selectedMoods) setSelectedMoods(parsed.selectedMoods);
                    } catch (e) {}
                }
            }, []);

            useEffect(() => {
                const configToSave = { geminiKey, gptKey, apiProvider, persona, library, selectedInstruments, selectedMoods };
                localStorage.setItem('electoy-studio-config-v14', JSON.stringify(configToSave));
            }, [geminiKey, gptKey, apiProvider, persona, library, selectedInstruments, selectedMoods]);

            const showToast = (msg) => {
                setToast({ show: true, message: msg });
                setTimeout(() => setToast({ show: false, message: '' }), 3000);
            };

            const toggleInstrument = (inst) => {
                if (selectedInstruments.includes(inst)) {
                    setSelectedInstruments(prev => prev.filter(i => i !== inst));
                } else if (selectedInstruments.length < 5) {
                    setSelectedInstruments(prev => [...prev, inst]);
                } else {
                    showToast("ÏïÖÍ∏∞Îäî ÏµúÎåÄ 5Í∞úÍπåÏßÄ ÏÑ†ÌÉù Í∞ÄÎä•Ìï©ÎãàÎã§.");
                }
            };

            const toggleMood = (mood) => {
                if (selectedMoods.includes(mood)) {
                    setSelectedMoods(prev => prev.filter(m => m !== mood));
                } else if (selectedMoods.length < 4) {
                    setSelectedMoods(prev => [...prev, mood]);
                } else {
                    showToast("Î¨¥ÎìúÎäî ÏµúÎåÄ 4Í∞úÍπåÏßÄ ÏÑ†ÌÉù Í∞ÄÎä•Ìï©ÎãàÎã§.");
                }
            };
            
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const handleSaveToLibrary = () => {
                if (!editableLyrics || !editableStyle) { showToast("Î®ºÏ†Ä Í≥°ÏùÑ ÏÉùÏÑ±Ìï¥ Ï£ºÏÑ∏Ïöî!"); return; }
                const newProject = { id: Date.now(), title: title || "Î¨¥Ï†ú ÌîÑÎ°úÏ†ùÌä∏", lyrics: editableLyrics, style: editableStyle, date: new Date().toLocaleDateString() };
                setLibrary(prev => [newProject, ...prev]);
                showToast("Î≥¥Í¥ÄÌï®Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!");
            };

            const deleteLibraryItem = (id, e) => { e.stopPropagation(); setLibrary(prev => prev.filter(item => item.id !== id)); showToast("ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§."); };
            const clearAllLibrary = () => { setLibrary([]); setShowClearConfirm(false); showToast("Î≥¥Í¥ÄÌï®ÏùÑ Î™®Îëê ÎπÑÏõ†ÏäµÎãàÎã§."); };
            const loadLibraryItem = (item) => { setTitle(item.title); setEditableLyrics(item.lyrics); setEditableStyle(item.style); setHasResult(true); showToast(`'${item.title}' ÏûëÏóÖÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.`); };

            const handleRefineLyrics = async () => {
                const currentKey = apiProvider === 'gemini' ? geminiKey : gptKey;
                if (!currentKey) { setShowApiModal(true); return; }
                
                setGeneratingType('refine');
                const systemPrompt = `Ï†ÑÎ¨∏ ÏûëÏÇ¨Í∞Ä. JSON ÏùëÎãµ: {"lyrics": "string"}`;
                try {
                    let resultText = "";
                    if (apiProvider === 'gemini') {
                         const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${geminiKey}`, {
                            method: 'POST', headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: `ÌòÑÏû¨Í∞ÄÏÇ¨: ${editableLyrics}\nÏöîÏ≤≠: ${revisionPrompt}` }] }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json" } })
                        });
                        const data = await response.json();
                        resultText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } else {
                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${gptKey}` },
                            body: JSON.stringify({
                                model: "gpt-4o",
                                messages: [{role: "system", content: systemPrompt}, {role: "user", content: `ÌòÑÏû¨Í∞ÄÏÇ¨: ${editableLyrics}\nÏöîÏ≤≠: ${revisionPrompt}`}],
                                response_format: { type: "json_object" }
                            })
                        });
                        const data = await response.json();
                        resultText = data.choices[0].message.content;
                    }

                    if (resultText) {
                         setEditableLyrics(JSON.parse(resultText).lyrics); setRevisionPrompt(''); showToast('ÏàòÏ†ï ÏôÑÎ£å!');
                    }
                } catch (e) { showToast('Ïò§Î•ò Î∞úÏÉù'); } finally { setGeneratingType(null); }
            };

            const handleGenerate = async (lang = 'ko') => {
                const currentKey = apiProvider === 'gemini' ? geminiKey : gptKey;
                if (!currentKey) { setShowApiModal(true); return; }
                
                setGeneratingType(lang); setHasResult(false);
                
                const styleInstruction = `Generate a long, highly detailed music style prompt in English for Suno AI. Include genres, textures, vocal processing, and audio engineering terms.`;
                const systemPrompt = lang === 'en'
                    ? `Master Producer. BOTH lyrics and style_prompt in English. JSON: {"style_prompt": "string", "lyrics": "string"}`
                    : `ÎßàÏä§ÌÑ∞ ÌîÑÎ°úÎìÄÏÑú. Í∞ÄÏÇ¨Îäî ÌïúÍµ≠Ïñ¥, 'style_prompt'Îäî Î¨¥Ï°∞Í±¥ Îß§Ïö∞ Í∏¥ ÏòÅÏñ¥(English) ÌÉúÍ∑∏Î°úÎßå ÏûëÏÑ±. JSON: {"style_prompt": "string", "lyrics": "string"}`;
                
                const instString = selectedInstruments.join(', ');
                const moodString = selectedMoods.join(', ');
                const userQuery = `Ï†úÎ™©: ${title}, Ïû•Î•¥: ${selectedGenres.join(',')}, Î¨¥Îìú: ${moodString}, ÏóêÎÑàÏßÄÎ†àÎ≤®: ${energy}, ÏòÅÍ∞ê: ${prompt}, ÌéòÎ•¥ÏÜåÎÇò: ${JSON.stringify(persona)}, ÏÇ¨Ïö© ÏïÖÍ∏∞: ${instString}, BPM: ${bpm}`;

                try {
                    let resultText = "";
                    
                    if (apiProvider === 'gemini') {
                         const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${geminiKey}`, {
                            method: 'POST', headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json" } })
                        });
                        const data = await response.json();
                        resultText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } else {
                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${gptKey}` },
                            body: JSON.stringify({
                                model: "gpt-4o",
                                messages: [{role: "system", content: systemPrompt}, {role: "user", content: userQuery}],
                                response_format: { type: "json_object" }
                            })
                        });
                        const data = await response.json();
                        resultText = data.choices[0].message.content;
                    }

                    if (resultText) {
                        const parsed = JSON.parse(resultText);
                        setEditableStyle(parsed.style_prompt); setEditableLyrics(parsed.lyrics); setHasResult(true);
                    }
                } catch (e) { showToast('ÏÉùÏÑ± Ïã§Ìå®: API ÌÇ§Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.'); console.error(e); } finally { setGeneratingType(null); }
            };

            const copyToClipboard = (text, type) => {
                const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.select(); document.execCommand('copy'); document.body.removeChild(textArea);
                setCopyStatus(prev => ({ ...prev, [type]: true })); setTimeout(() => setCopyStatus(prev => ({ ...prev, [type]: false })), 2000);
            };

            // Fix for ReferenceError: Define apiKey derived from state
            const apiKey = apiProvider === 'gemini' ? geminiKey : gptKey;

            return (
                <div className="app-container text-slate-200 bg-slate-950 text-left">
                    
                    {/* ÏûÖÏû• ÌôîÎ©¥ */}
                    <div className={`entrance-overlay ${isEntered ? 'hidden' : ''}`} style={{ backgroundImage: `url(${entranceImageUrl})` }}>
                        <div className="relative flex flex-col items-center space-y-12 text-center px-10 animate-in fade-in zoom-in duration-1000">
                            <div className="space-y-4">
                                <h1 className="text-7xl font-black text-white uppercase tracking-tighter drop-shadow-lg text-left">Electoy Studio</h1>
                                <p className="text-slate-200 text-lg font-bold tracking-[0.4em] uppercase opacity-80 text-left">AI Master Music Production</p>
                            </div>
                            <button onClick={() => setIsEntered(true)} className="px-24 py-8 bg-purple-600 rounded-full font-black text-2xl text-white shadow-2xl active:scale-95 transition-all flex items-center gap-5 animate-pulse-glow uppercase tracking-widest text-left">START PRODUCTION</button>
                        </div>
                        <div className="absolute bottom-10 text-white/40 font-black text-xs uppercase tracking-[0.6em] text-left">Electoy Studio ‚Ä¢ Master v14.6</div>
                    </div>

                    <header className="shrink-0 bg-slate-900/90 backdrop-blur-md border-b-2 border-slate-800 p-6 flex items-center justify-between sticky top-0 z-50">
                        <div className="flex items-center gap-4 text-left"><div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center shadow-lg text-white"><Icon name="Music" size={24} /></div><h1 className="font-black text-2xl uppercase tracking-tight text-white">Electoy Studio</h1></div>
                        <div className="flex items-center gap-3 text-left"><button onClick={() => showToast("Ï£ºÏÜå Î≥µÏÇ¨Îê®!")} className="p-4 rounded-xl bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 transition-all shadow-inner text-left"><Icon name="Share" size={24} /></button><button onClick={() => setShowApiModal(true)} className={`p-4 rounded-xl border border-slate-700 ${apiKey ? 'text-green-400 bg-green-900/20' : 'text-slate-400 bg-slate-800'} text-left`}><Icon name="Key" size={24} /></button></div>
                    </header>
                    <main className="flex-1 overflow-y-auto custom-scrollbar p-8 space-y-12 pb-56 text-left">
                        {toast.show && <div className="fixed top-28 left-1/2 -translate-x-1/2 z-[200] px-10 py-5 bg-slate-800 border border-slate-600 text-white font-black text-xl rounded-full shadow-2xl animate-bounce text-center">{toast.message}</div>}
                        
                        <section className="space-y-4 text-left"><label className="text-sm font-bold text-slate-400 uppercase tracking-widest ml-2 text-left">Project Title</label><input type="text" value={title} onChange={(e) => setTitle(e.target.value)} placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." className="w-full bg-slate-900 border border-slate-700 rounded-2xl px-8 py-5 text-2xl font-bold outline-none focus:border-slate-500 transition-all text-white text-left" /></section>
                        
                        <section className="space-y-6 text-left">
                            <label className="text-sm font-bold text-slate-400 uppercase ml-2 flex items-center gap-4 text-left"><Icon name="Sparkles" size={20} /> Ïä§ÌÉÄÏùº ÌîÑÎ¶¨ÏÖã</label>
                            <div className="flex flex-wrap gap-2 text-left">
                                {themes.map(cat => (
                                    <button key={cat.category} onClick={() => setActiveThemeTab(cat.category)} className={`px-5 py-3 text-sm font-bold rounded-lg transition-all ${activeThemeTab === cat.category ? 'active-tab' : 'bg-slate-900 text-slate-400 border border-slate-700 hover:bg-slate-800'}`}>{cat.category}</button>
                                ))}
                            </div>
                            <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 text-left">
                                {themes.find(t => t.category === activeThemeTab)?.items.map(item => (
                                    <button key={item.id} onClick={() => { setSelectedGenres([item.genre]); setSelectedMoods(item.moods); setSelectedInstruments(item.inst); setPersona(p => ({...p, gender: item.gender})); setBpm(item.bpm); showToast(`'${item.label}' Ï†ÅÏö©!`); }} className="card-container text-base font-bold text-slate-300 hover:border-slate-500 hover:text-white transition-all active:scale-95 text-left leading-tight h-full">{item.label}</button>
                                ))}
                            </div>
                        </section>

                        <section className="card-container space-y-10 text-left">
                            <div className="flex justify-between items-center text-left"><label className="text-xl font-black text-slate-300 uppercase tracking-widest text-left"><Icon name="Key" size={20}/> ÏÉÅÏÑ∏ ÏÑ§Ï†ï</label><button onClick={() => { const newGender = isInstrumental ? 'Ïó¨ÏÑ±' : 'Ïó∞Ï£ºÍ≥° (Instrumental)'; setPersona(prev => ({ ...prev, gender: newGender })); showToast(newGender === 'Ïó¨ÏÑ±' ? "Î≥¥Ïª¨ Î™®ÎìúÎ°ú Ï†ÑÌôò" : "Ïó∞Ï£ºÍ≥° Î™®Îìú ON"); }} className={`px-8 py-4 rounded-xl text-lg font-bold transition-all border ${isInstrumental ? 'bg-slate-700 text-white border-slate-500' : 'bg-slate-900 text-slate-500 border-slate-700'}`}>Ïó∞Ï£ºÍ≥° Î™®Îìú {isInstrumental ? 'ON' : 'OFF'}</button></div>
                            {isInstrumental && (
                                <div className="grid grid-cols-2 gap-4 pb-4 animate-in zoom-in-95 text-left">
                                    {instrumentalSubStyles.map(s => (
                                        <button key={s.id} onClick={() => { setSelectedGenres([s.genre]); setSelectedMoods(s.moods); setSelectedInstruments(s.inst); setBpm(s.bpm); showToast(`'${s.label}' Ï†ÅÏö©!`); }} className="p-5 bg-slate-900 border border-slate-700 rounded-2xl text-lg font-bold text-slate-300 text-left hover:border-slate-500 hover:text-white transition-all shadow-lg">{s.label}</button>
                                    ))}
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 text-left">
                                <button onClick={() => setShowPersonaModal(true)} className="card-container text-left hover:border-slate-500 active:scale-95 transition-all min-h-[160px]">
                                    <div className="text-xs text-slate-400 font-bold mb-4 uppercase tracking-widest flex items-center gap-2 text-left"><Icon name="User" size={16}/> Î≥¥Ïª¨ ÌéòÎ•¥ÏÜåÎÇò</div>
                                    <div className="space-y-2 mb-4 text-left">
                                        <div className="flex flex-wrap gap-2 text-left"><span className="persona-badge text-left">{persona.name}</span><span className="persona-badge text-left">{persona.gender}</span><span className="persona-badge text-left">{persona.age}</span></div>
                                        <div className="text-lg text-slate-200 font-bold leading-snug text-left">{persona.tone} / {persona.style}</div>
                                    </div>
                                </button>
                                <div className="grid grid-cols-2 gap-6 text-left">
                                    <button onClick={() => setShowMoodModal(true)} className="card-container text-left hover:border-slate-500 active:scale-95 transition-all text-left">
                                        <div className="text-xs text-slate-400 font-bold mb-4 uppercase tracking-widest flex items-center gap-2 text-left"><Icon name="Heart" size={16}/> Î∂ÑÏúÑÍ∏∞</div>
                                        <div className="flex flex-wrap gap-2 text-left">
                                            {selectedMoods.slice(0, 2).map(m => <span key={m} className="persona-badge text-left">{m}</span>)}
                                            {selectedMoods.length > 2 && <span className="persona-badge text-left">+{selectedMoods.length-2}</span>}
                                        </div>
                                    </button>

                                    <button onClick={() => setShowInstModal(true)} className="card-container text-left hover:border-slate-500 active:scale-95 transition-all text-left">
                                        <div className="text-xs text-slate-400 font-bold mb-4 uppercase tracking-widest flex items-center gap-2 text-left"><Icon name="Layout" size={16}/> ÏïÖÍ∏∞ Íµ¨ÏÑ±</div>
                                        <div className="flex flex-wrap gap-2 text-left">
                                            {selectedInstruments.slice(0, 2).map(i => <span key={i} className="persona-badge text-left">{i}</span>)}
                                            {selectedInstruments.length > 2 && <span className="persona-badge text-left">+{selectedInstruments.length-2}</span>}
                                        </div>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-6 border-t border-slate-800 text-left">
                                <div className="space-y-4 text-left">
                                    <div className="flex justify-between text-sm font-bold text-slate-400 uppercase tracking-widest text-left"><span>BPM (ÏÜçÎèÑ)</span><span className="text-white text-xl font-mono text-left">{bpm}</span></div>
                                    <input type="range" min="40" max="200" step="10" value={bpm} onChange={(e) => setBpm(parseInt(e.target.value))} className="w-full h-2 cursor-pointer rounded-lg appearance-none bg-slate-800 text-left" />
                                </div>
                                <div className="space-y-4 text-left">
                                    <div className="flex justify-between text-sm font-bold text-slate-400 uppercase tracking-widest text-left"><span>Í≥° Í∏∏Ïù¥ (Duration)</span><span className="text-white text-xl font-mono text-left">{formatTime(duration)}</span></div>
                                    <input type="range" min="30" max="360" step="10" value={duration} onChange={(e) => setDuration(parseInt(e.target.value))} className="w-full h-2 cursor-pointer rounded-lg appearance-none bg-slate-800 text-left" />
                                </div>
                            </div>
                        </section>

                        <section className="space-y-8 text-left"><textarea value={prompt} onChange={(e) => setPrompt(e.target.value)} placeholder="ÏùåÏïÖÏ†Å ÏïÑÏù¥ÎîîÏñ¥Î•º ÏûêÏú†Î°≠Í≤å Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî..." className="w-full bg-slate-900 border border-slate-700 rounded-[3rem] p-10 h-80 text-2xl font-bold outline-none focus:border-slate-500 transition-all text-white shadow-inner leading-relaxed text-left" /><div className="grid grid-cols-2 gap-8 text-white text-left">
                            <button onClick={() => handleGenerate('ko')} disabled={generatingType !== null} className="py-8 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-[2.5rem] font-black text-2xl shadow-xl flex items-center justify-center gap-4 active:scale-95 transition-all text-center">
                                {generatingType === 'ko' ? <Icon name="Refresh" className="animate-spin" size={28} /> : <Icon name="Sparkles" size={28} />} ÏÉùÏÑ±
                            </button>
                            <button onClick={() => handleGenerate('en')} disabled={generatingType !== null} className="py-8 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-[2.5rem] font-black text-2xl flex items-center justify-center gap-4 active:scale-95 shadow-xl text-center">
                                {generatingType === 'en' ? <Icon name="Refresh" className="animate-spin" size={28} /> : <Icon name="Globe" size={28} />} ENGLISH
                            </button>
                        </div></section>

                        <section className="pt-24 border-t border-slate-800 space-y-16 text-left">
                            {hasResult && (
                                <div className="space-y-20 animate-in slide-in-from-bottom-10 duration-700 text-left">
                                    <div className="card-container text-left">
                                        <div className="flex justify-between items-center mb-10 text-left">
                                            <span className="text-2xl font-black text-slate-200 uppercase tracking-widest text-left">ÏÉùÏÑ±Îêú Í≤∞Í≥º (Results)</span>
                                            <div className="flex items-center gap-4 text-left">
                                                <button onClick={handleSaveToLibrary} className="px-6 py-4 bg-slate-800 border border-slate-600 rounded-[2rem] shadow-lg active:scale-90 flex items-center gap-3 font-bold text-lg hover:bg-slate-700 text-left"><Icon name="Save" size={24} /> Ï†ÄÏû•</button>
                                                <button onClick={() => copyToClipboard(editableLyrics, 'lyrics')} className="p-4 bg-slate-800 border border-slate-600 rounded-[2rem] shadow-lg active:scale-90 hover:bg-slate-700 text-left">{copyStatus.lyrics ? <Icon name="Check" size={28} className="text-green-400" /> : <Icon name="Copy" size={28} />}</button>
                                            </div>
                                        </div>
                                        <textarea className="editable-area h-[800px] text-left" value={editableLyrics} onChange={(e) => setEditableLyrics(e.target.value)} />
                                        <div className="mt-12 p-10 bg-slate-950/40 rounded-[3rem] border border-dashed border-slate-700 space-y-8 text-left">
                                            <label className="text-lg font-bold text-slate-400 uppercase flex items-center gap-4 tracking-widest text-left"><Icon name="Pencil" size={20} /> Í∞ÄÏÇ¨ ÏàòÏ†ï ÎπÑÏÑú</label>
                                            <textarea value={revisionPrompt} onChange={(e) => setRevisionPrompt(e.target.value)} placeholder="ÏàòÏ†ï ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." className="revision-input text-white shadow-inner" />
                                            <div className="flex justify-end text-left"><button onClick={handleRefineLyrics} disabled={generatingType !== null} className="px-8 py-4 bg-slate-800 hover:bg-slate-700 rounded-2xl text-lg font-bold border border-slate-600 transition-all text-white shadow-xl flex items-center gap-3 active:scale-95 text-center">{generatingType === 'refine' ? <Icon name="Refresh" className="animate-spin" size={20} /> : <Icon name="Check" size={20} />} ÏàòÏ†ï ÏöîÏ≤≠</button></div>
                                        </div>
                                    </div>
                                    <div className="card-container text-left">
                                        <div className="flex justify-between items-center mb-10 text-left"><span className="text-2xl font-black text-slate-200 uppercase tracking-widest text-left">Ïä§ÌÉÄÏùº ÌÉúÍ∑∏</span><button onClick={() => copyToClipboard(editableStyle, 'style')} className="p-4 bg-slate-800 border border-slate-600 rounded-[2rem] shadow-lg active:scale-90 hover:bg-slate-700 text-left">{copyStatus.style ? <Icon name="Check" size={28} className="text-green-400" /> : <Icon name="Copy" size={28} />}</button></div>
                                        <textarea className="editable-area h-64 font-mono text-slate-300 shadow-inner font-bold text-left" value={editableStyle} onChange={(e) => setEditableStyle(e.target.value)} />
                                    </div>
                                </div>
                            )}

                            <section className="space-y-8 pt-20 border-t border-slate-800 text-left">
                                <div className="flex justify-between items-center px-4 text-left">
                                    <div className="flex items-center gap-4 text-slate-500 text-left"><Icon name="Library" size={28} /><h2 className="text-2xl font-black uppercase tracking-widest text-left">My Library</h2></div>
                                    {library.length > 0 && (<button onClick={() => setShowClearConfirm(true)} className="text-xs font-bold text-red-400 hover:text-red-300 border border-red-500/20 px-4 py-2 rounded-lg transition-all text-left">Ï†ÑÏ≤¥ ÎπÑÏö∞Í∏∞</button>)}
                                </div>
                                {library.length === 0 ? (<div className="p-20 border border-dashed border-slate-700 rounded-[3rem] text-center text-slate-600 font-bold text-left">Ï†ÄÏû•Îêú ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§.</div>) : (
                                    <div className="space-y-4 text-left">
                                        {library.map(item => (
                                            <div key={item.id} onClick={() => loadLibraryItem(item)} className="library-item p-8 rounded-[2rem] flex justify-between items-center cursor-pointer group animate-in slide-in-from-left-5 text-left">
                                                <div className="space-y-2 text-left"> <div className="text-xl font-black text-slate-200 group-hover:text-purple-400 transition-all text-left">{item.title}</div> <div className="text-sm text-slate-500 font-bold text-left">{item.date} ‚Ä¢ {item.lyrics.substring(0, 30)}...</div> </div>
                                                <button onClick={(e) => deleteLibraryItem(item.id, e)} className="p-4 text-slate-500 hover:text-red-400 transition-all active:scale-90 text-left"><Icon name="Trash" size={24} /></button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </section>
                        </section>
                    </main>

                    {showClearConfirm && (
                        <div className="fixed inset-0 z-[400] modal-overlay flex items-center justify-center p-6 text-left" onClick={() => setShowClearConfirm(false)}>
                            <div className="confirm-modal animate-in zoom-in-95 text-left" onClick={e => e.stopPropagation()}>
                                <Icon name="AlertCircle" size={48} className="text-red-500 mx-auto mb-4" /><h3 className="text-xl font-black text-white mb-2 text-center">Î≥¥Í¥ÄÌï®ÏùÑ ÎπÑÏö∏ÍπåÏöî?</h3><p className="text-slate-400 text-sm mb-8 text-center">Ï†ÄÏû•Îêú Î™®Îì† Í≥°Ïù¥ ÏÇ≠Ï†úÎêòÎ©∞<br/>Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</p>
                                <div className="grid grid-cols-2 gap-4"><button onClick={() => setShowClearConfirm(false)} className="py-4 bg-slate-800 rounded-xl font-black text-slate-300">Ï∑®ÏÜå</button><button onClick={clearAllLibrary} className="py-4 bg-red-600 rounded-xl font-black text-white">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button></div>
                            </div>
                        </div>
                    )}
                    
                    {showApiModal && (
                        <div className="fixed inset-0 z-[300] modal-overlay flex items-center justify-center p-12 text-left" onClick={() => setShowApiModal(false)}>
                            <div className="bg-slate-900 border border-slate-600 w-full max-w-xl rounded-[3rem] p-10 space-y-8 text-left animate-in zoom-in-95 shadow-2xl">
                                <div className="flex justify-between items-center text-left mb-4">
                                    <div className="flex items-center gap-4 text-slate-300"><Icon name="Key" size={32} /><h3 className="font-black text-2xl uppercase tracking-widest">API Key Setup</h3></div>
                                    <div className="cursor-pointer text-slate-500 hover:text-white transition-all text-left" onClick={() => setShowApiModal(false)}><Icon name="X" size={48} /></div>
                                </div>
                                
                                {/* ÌÉ≠ Î©îÎâ¥ */}
                                <div className="flex gap-4 border-b border-slate-700 pb-1">
                                    <button onClick={() => setApiProvider('gemini')} className={`api-tab ${apiProvider === 'gemini' ? 'active' : ''}`}>Gemini (Free)</button>
                                    <button onClick={() => setApiProvider('gpt')} className={`api-tab ${apiProvider === 'gpt' ? 'active' : ''}`}>GPT-4o (Paid)</button>
                                </div>

                                {/* ÏûÖÎ†• ÌïÑÎìú */}
                                <div className="space-y-4 text-left">
                                    {apiProvider === 'gemini' ? (
                                        <div className="animate-in fade-in slide-in-from-top-2">
                                            <label className="text-[11px] font-black text-slate-500 uppercase ml-2 tracking-[0.3em] text-left">Google Gemini API Key</label>
                                            <input type="password" placeholder="Gemini ÌÇ§ ÏûÖÎ†•..." value={geminiKey} onChange={(e) => setGeminiKey(e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded-[1.5rem] p-6 text-2xl text-white outline-none focus:border-purple-500 shadow-inner text-left" autoFocus />
                                        </div>
                                    ) : (
                                        <div className="animate-in fade-in slide-in-from-top-2">
                                            <label className="text-[11px] font-black text-slate-500 uppercase ml-2 tracking-[0.3em] text-left">OpenAI GPT API Key</label>
                                            <input type="password" placeholder="sk-..." value={gptKey} onChange={(e) => setGptKey(e.target.value)} className="w-full bg-slate-800 border border-slate-600 rounded-[1.5rem] p-6 text-2xl text-white outline-none focus:border-blue-500 shadow-inner text-left" autoFocus />
                                        </div>
                                    )}
                                </div>
                                <button onClick={() => { setShowApiModal(false); showToast("API ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§."); }} className="w-full bg-slate-700 hover:bg-slate-600 py-8 rounded-[2rem] font-black text-2xl shadow-xl text-center text-white">Save & Close</button>
                            </div>
                        </div>
                    )}
                    
                    {showPersonaModal && (
                        <div className="fixed inset-0 z-[300] modal-overlay flex items-center justify-center p-6 text-left" onClick={() => setShowPersonaModal(false)}>
                            <div className="bg-slate-900 border border-slate-600 w-full max-w-md max-h-[90vh] overflow-y-auto rounded-[3rem] p-8 space-y-8 animate-in zoom-in-95 custom-scrollbar shadow-2xl text-left" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center border-b border-slate-700 pb-4 text-left">
                                    <div className="flex items-center gap-3 text-slate-300"><Icon name="User" size={24} /><h3 className="font-black text-xl uppercase tracking-widest text-left">Vocal Persona</h3></div>
                                    <div className="cursor-pointer text-slate-500 hover:text-white transition-all text-left" onClick={() => setShowPersonaModal(false)}><Icon name="X" size={32} /></div>
                                </div>
                                <div className="bg-slate-950/80 border border-slate-700 rounded-2xl p-5 space-y-3 text-left">
                                    <div className="flex items-center gap-2 text-[10px] text-slate-500 font-black uppercase tracking-widest text-left"><Icon name="Save" size={12} /> ÌòÑÏû¨ Í∏∞ÏñµÎêú ÌîÑÎ°úÌïÑ</div>
                                    <div className="flex flex-wrap gap-2 text-left"><span className="persona-badge text-left">{persona.name}</span><span className="persona-badge text-left">{persona.gender}</span><span className="persona-badge text-left">{persona.age}</span></div>
                                </div>
                                <div className="space-y-6 text-left">
                                    <div className="space-y-2 text-left">
                                        <label className="text-[11px] font-black text-slate-500 uppercase ml-1 tracking-widest text-left flex items-center gap-2 text-left"><Icon name="Tag" size={12}/> ÌéòÎ•¥ÏÜåÎÇò Ïù¥Î¶Ñ</label>
                                        <input type="text" value={persona.name} onChange={(e) => setPersona(prev => ({ ...prev, name: e.target.value }))} placeholder="Ïòà: Î©îÏù∏ Î≥¥Ïª¨" className="w-full bg-slate-800 border border-slate-600 rounded-xl p-4 text-base font-bold text-white outline-none focus:border-slate-500 shadow-inner text-left" />
                                    </div>
                                    {[{ key: 'gender', label: 'Î≥¥Ïª¨ ÌÉÄÏûÖ', opts: ['Ïó¨ÏÑ±', 'ÎÇ®ÏÑ±', 'ÎÇ®ÎÖÄ ÎìÄÏó£', 'Ï§ëÏÑ±Ï†Å', 'Ìï©Ï∞ΩÎã®', 'Ïó∞Ï£ºÍ≥° (Instrumental)'] }, { key: 'age', label: 'Ïó∞Î†πÎåÄ', opts: ['10ÎåÄ', '20ÎåÄ', '30ÎåÄ', 'Ï§ëÌõÑÌïú'] }, { key: 'tone', label: 'Î™©ÏÜåÎ¶¨ ÌÜ§', opts: ['ÎßëÍ≥† Íπ®ÎÅóÌïú', 'ÌóàÏä§ÌÇ§Ìïú', 'ÌååÏõåÌíÄÌïú', 'Í∞êÎØ∏Î°úÏö¥', 'ÎÇ†Ïπ¥Î°úÏö¥'] }, { key: 'style', label: 'Ï∞ΩÎ≤ï', opts: ['Í∞êÏÑ±Ï†ÅÏù∏', 'Í∏∞ÍµêÏûàÎäî', 'Îã¥Î∞±Ìïú', 'ÌùêÎäêÎÅºÎäî', 'Ï†àÏ†úÎêú'] }].map(item => (
                                        <div key={item.key} className="space-y-2 text-left">
                                            <label className="text-[11px] font-black text-slate-500 uppercase ml-1 tracking-widest text-left">{item.label}</label>
                                            <select value={persona[item.key]} onChange={(e) => setPersona(prev => ({ ...prev, [item.key]: e.target.value }))} className="w-full bg-slate-800 border border-slate-600 rounded-xl p-4 text-base font-bold text-white outline-none focus:border-slate-500 appearance-none shadow-inner text-left">{item.opts.map(o => <option key={o} value={o}>{o}</option>)}</select>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => setShowPersonaModal(false)} className="w-full bg-purple-600 hover:bg-purple-500 py-5 rounded-2xl font-black text-lg shadow-xl text-center flex items-center justify-center gap-3 text-left"> <Icon name="Check" size={20} /> Ï†ÄÏû• Î∞è Ï†ÅÏö© </button>
                            </div>
                        </div>
                    )}
                    
                    {showMoodModal && (
                        <div className="fixed inset-0 z-[400] modal-overlay flex items-center justify-center p-6 text-left" onClick={() => setShowMoodModal(false)}>
                            <div className="bg-[#0f172a] border border-slate-600 w-full max-w-md max-h-[90vh] overflow-y-auto rounded-[2rem] p-8 space-y-10 animate-in zoom-in-95 custom-scrollbar shadow-2xl text-left" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center text-left">
                                    <h3 className="font-black text-2xl text-white text-left">Î∂ÑÏúÑÍ∏∞</h3>
                                    <div className="cursor-pointer text-slate-500 hover:text-white transition-all text-left" onClick={() => setShowMoodModal(false)}><Icon name="X" size={32} /></div>
                                </div>
                                <div className="grid grid-cols-4 gap-2 text-left"> {moodsGrid.map(mood => ( <button key={mood} onClick={() => toggleMood(mood)} className={`mood-chip ${selectedMoods.includes(mood) ? 'selected' : ''} text-left`}> {mood} </button> ))} </div>
                                <div className="space-y-6 pt-4 text-left">
                                    <h3 className="font-black text-2xl text-white text-left">ÏóêÎÑàÏßÄ</h3>
                                    <div className="grid grid-cols-3 gap-3 text-left"> {energyOptions.map(opt => ( <button key={opt} onClick={() => setEnergy(opt)} className={`mood-chip !py-4 ${energy === opt ? 'selected' : ''} text-left`}> {opt} </button> ))} </div>
                                </div>
                                <button onClick={() => setShowMoodModal(false)} className="w-full bg-blue-600 hover:bg-blue-500 py-6 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-all text-white text-center text-left"> ÏÑ†ÌÉù ÏôÑÎ£å </button>
                            </div>
                        </div>
                    )}

                    {showInstModal && (
                        <div className="fixed inset-0 z-[400] modal-overlay flex items-center justify-center p-6 text-left" onClick={() => setShowInstModal(false)}>
                            <div className="bg-[#0f172a] border border-slate-600 w-full max-w-md max-h-[90vh] overflow-y-auto rounded-[2rem] p-8 space-y-10 animate-in zoom-in-95 custom-scrollbar shadow-2xl text-left" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center text-left">
                                    <div className="flex items-center gap-3 text-pink-400 text-left"> <Icon name="Layout" size={24} /> <h3 className="font-black text-2xl text-white text-left">ÏïÖÍ∏∞ Íµ¨ÏÑ±</h3> </div>
                                    <div className="cursor-pointer text-slate-500 hover:text-white transition-all text-left" onClick={() => setShowInstModal(false)}><Icon name="X" size={32} /></div>
                                </div>
                                <div className="space-y-4 text-left">
                                    <div className="flex justify-between items-center text-left">
                                        <span className="text-slate-500 text-xs font-black uppercase tracking-widest text-left">Ï†ÑÏ≤¥ ÏïÖÍ∏∞ Î¶¨Ïä§Ìä∏</span>
                                        <span className="text-pink-400 text-xs font-black text-left">{selectedInstruments.length} / 5</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2 text-left">
                                        {instrumentsList.map(inst => (
                                            <button key={inst} onClick={() => toggleInstrument(inst)} className={`inst-chip ${selectedInstruments.includes(inst) ? 'selected' : ''} text-left`}> {inst} </button>
                                        ))}
                                    </div>
                                </div>
                                <button onClick={() => setShowInstModal(false)} className="w-full bg-pink-600 hover:bg-pink-500 py-6 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-all text-white text-center"> ÏÑ†ÌÉù ÏôÑÎ£å </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(App));
    </script>
</body>
</html>